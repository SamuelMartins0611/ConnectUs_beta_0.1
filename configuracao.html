<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ConnectUs ‚Äî Configura√ß√£o de Perfil</title>
<link rel="icon" href="favicon.png?v=2">
  <link rel="apple-touch-icon" href="favicon.png">


<style>
/* ===========================================
   VARI√ÅVEIS
=========================================== */
:root {
  --bg:#000000;
  --fg:#ffffff;
  --card:#151515;
  --muted:#c6c6c6;
  --accent:#4aa3ff;
  --btn:#1f1f1f;

  --radius:12px;
  --border-strong:#3d3d3d;
  --input-bg:#0d0d0d;
  --input-border:#575757;
  --hover-bg:#1f1f1f;
}

/* ===========================================
   BODY / GLOBAL
=========================================== */
body {
  margin:0;
  font-family:Arial, sans-serif;
  background:var(--bg);
  color:var(--fg);
  transition:background .25s, color .25s;
}

/* ===========================================
   DROPDOWN DE ACESSIBILIDADE
=========================================== */
.top-acessibilidade {
  margin-left:auto;
  display:flex;
  align-items:center;
}

.top-acessibilidade select {
  background:#2a2a2a;
  color:#fff;
  border:2px solid var(--border-strong);
  padding:4px 6px;
  border-radius:10px;
  cursor:pointer;
  height:38px;
  width:38px;
  font-size:22px;
  text-align:center;
  outline:none;
  transition:.15s;
  appearance:none;
}

.top-acessibilidade select:hover {
  background:#3a3a3a;
  border-color:var(--accent);
}

.temaClaro .top-acessibilidade select {
  background:#ddd;
  color:#111;
  border:1px solid #bbb;
}

/* Ocultar texto das op√ß√µes (apenas √≠cone vis√≠vel) */
.top-acessibilidade select option {
  color:#fff;
}
.top-acessibilidade select option:first-child {
  font-size:22px;
}
.top-acessibilidade select:not(:focus):not(:active) option:not(:first-child) {
  display:none;
}

/* ===========================================
   HEADER ‚Äî t√≠tulo 100% centralizado
=========================================== */
header {
  background:#111;
  padding:14px 18px;
  border-bottom:2px solid rgba(255,255,255,.05);
  position:sticky;
  top:0;
  z-index:200;

  display:flex;
  align-items:center;
  justify-content:flex-start;
  position:relative;
  height:55px;
}

/* BOT√ÉO SAIR ‚Äî esquerda */
#btnHeaderSair {
  padding:8px 16px;
  background:#d9534f;
  border:none;
  border-radius:8px;
  font-size:14px;
  font-weight:700;
  color:#fff;
  cursor:pointer;
  transition:0.15s;
}
#btnHeaderSair:hover {
  background:#e56762;
  transform:translateY(-2px);
}

/* t√≠tulo centralizado */
header h1 {
  position:absolute;
  left:50%;
  transform:translateX(-50%);
  margin:0;
  font-size:20px;
  font-weight:700;
  white-space:nowrap;
  pointer-events:none;
}

/* tema claro (bot√£o sair) */
.temaClaro #btnHeaderSair {
  background:#e74c3c;
}
.temaClaro #btnHeaderSair:hover {
  background:#ff6b61;
}

/* ===========================================
   STRUCTURE
=========================================== */
.wrap {
  max-width:1000px;
  margin:25px auto;
  padding:18px;
}

.panel {
  background:var(--card);
  border-radius:var(--radius);
  padding:22px;
  border:2px solid var(--border-strong);
  box-shadow:0 0 16px rgba(0,0,0,.6);
}

/* GRID */
.row {
  display:flex;
  gap:16px;
  flex-wrap:wrap;
  align-items:flex-start;
}
.col {
  flex:1;
  min-width:260px;
}

/* LABELS */
label {
  display:block;
  font-weight:700;
  margin-bottom:6px;
  font-size:15px;
  color:#ffffff;
  letter-spacing:0.3px;
}

.small {
  font-size:13px;
  margin-top:6px;
  color:var(--muted);
}

/* INPUTS */
input[type="text"],
input[type="password"],
select,
textarea {
  width:100%;
  padding:12px 14px;
  border-radius:10px;
  border:2px solid var(--input-border);
  background:var(--input-bg);
  color:#ffffff;
  font-size:15px;
  box-sizing:border-box;
  transition:.15s;
}

textarea {
  min-height:90px;
  resize:vertical;
}

input:focus,
textarea:focus,
select:focus {
  border-color:var(--accent);
  background:#000;
  box-shadow:0 0 6px var(--accent);
}

::placeholder {
  color:#b9b9b9;
}

/* FAVORITOS */
.fav-list {
  display:flex;
  gap:8px;
  margin-top:10px;
  flex-wrap:wrap;
}

.fav-item {
  background:#1f1f1f;
  padding:6px 10px;
  border-radius:8px;
  border:1px solid var(--border-strong);
  color:#fff;
  font-size:14px;
}

/* BOT√ïES */
.actions {
  display:flex;
  gap:12px;
  margin-top:20px;
  flex-wrap:wrap;
}

.btn {
  padding:10px 16px;
  border-radius:10px;
  border:2px solid var(--border-strong);
  background:var(--btn);
  color:#fff;
  cursor:pointer;
  font-weight:600;
  transition:.15s;
}

.btn:hover {
  background:var(--hover-bg);
}

.btn.primary {
  background:var(--accent);
  border:none;
  font-weight:700;
}
.btn.primary:hover {
  background:#6bbaff;
}

.btn.danger {
  background:#d9534f;
  border:none;
}
.btn.danger:hover {
  background:#e56762;
}

.btn.ghost {
  background:transparent;
  border:2px solid var(--border-strong);
}
.btn.ghost:hover {
  background:#1f1f1f;
}

/* SENHA */
.pwd-wrap {
  position:relative;
}
.pwd-toggle--config {
  position:absolute;
  right:12px;
  top:50%;
  transform:translateY(-50%);
  background:none;
  border:none;
  cursor:pointer;
  font-size:20px;
  color:#fff;
  text-shadow:0 0 4px rgba(255,255,255,.4);
}

/* MODAL */
.modal {
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.75);
  padding:24px;
  z-index:1500;
  align-items:center;
  justify-content:center;
}
.modal .box {
  max-width:700px;
  background:#141414;
  border-radius:12px;
  border:2px solid var(--border-strong);
  padding:20px;
}
.modal .box h3 {
  margin-top:0;
  color:#fff;
}

/* ===========================================================
   üì± RESPONSIVIDADE ‚Äî SOMENTE DO EDITOR DE PERFIL
   =========================================================== */
@media (max-width:720px){

    .wrap {
        padding: 10px;
    }

    .panel {
        padding: 16px;
        border-radius: 10px;
    }

    .panel h2 {
        font-size: 18px;
    }

    .small {
        font-size: 12px;
        line-height: 1.3;
    }

    /* For√ßa colunas a ficarem uma abaixo da outra */
    .row {
        flex-direction: column !important;
        gap: 14px !important;
    }

    .col {
        min-width: 100% !important;
        width: 100% !important;
    }

    /* Inputs gerais */
    input[type="text"],
    input[type="password"],
    textarea,
    .panel select {
        width: 100% !important;
        font-size: 14px;
        padding: 10px 12px;
    }

    label {
        margin-top: 10px;
        margin-bottom: 4px;
        font-size: 14px;
    }

    /* ============================
       üéØ √ÅREA DE FAVORITOS AJUSTADA
       ============================ */

    /* Linha vira coluna para mobile */
    .fav-row {
        display: flex !important;
        flex-direction: column !important;
        gap: 10px !important;
        width: 100% !important;
    }

    /* Input FAVORITOS corrigido */
    #favInput {
        flex: none !important;
        width: 100% !important;
        padding: 12px 14px !important;
        font-size: 16px !important;
        height: 45px !important;
        border: 2px solid var(--input-border) !important;
        background: var(--input-bg) !important;
        color: #fff !important;
        border-radius: 10px !important;
    }

    /* Bot√£o ADICIONAR espa√ßado e grande */
    #addFavBtn {
        width: 100% !important;
        font-size: 15px !important;
        padding: 12px !important;
        white-space: nowrap;
    }

    /* Lista de favoritos */
    #favList {
        width: 100%;
        margin-top: 10px;
    }

    .fav-item {
        padding: 5px 8px;
        font-size: 13px;
    }

    /* ============================
       Bot√µes da parte inferior
       ============================ */
    .actions {
        flex-direction: column !important;
        width: 100%;
        gap: 10px !important;
    }

    .btn {
        width: 100% !important;
        text-align: center;
        padding: 12px;
        font-size: 14px;
    }

    /* Campo de senha + olhinho */
    .pwd-wrap input {
        padding-right: 40px !important;
    }

    .pwd-toggle--config {
        right: 10px;
        font-size: 18px;
    }

    /* Linha divis√≥ria */
    hr {
        margin: 20px 0;
    }

    /* Ajuste do VLibras */
    [vw] {
        transform: scale(0.8);
        right: 10px !important;
        bottom: 40px !important;
    }
}

/* Ajustes extras para telas MUITO pequenas */
@media (max-width:380px){
    header h1 {
        font-size: 16px;
    }
}


</style>
</head>
<body>

<header>
  <button id="btnHeaderSair">Sair</button>

  <h1 onmouseover="lerTexto('Configura√ß√µes do perfil')">
       Configura√ß√µes
  </h1>

  <div class="top-acessibilidade">
      <select id="menuAcessibilidade" onchange="executarOpcao(this.value)">
          <option value="">‚öô</option>
          <option value="zoomIn">Aumentar Zoom</option>
          <option value="zoomOut">Diminuir Zoom</option>
          <option value="modoCalmo">Modo Calmo</option>
          <option value="pauseAudio">Pausar Leitura</option>
          <option value="resumeAudio">Retomar Leitura</option>
          <option value="toggleTheme">Tema Claro/Escuro</option>
          <option value="desativarVoz">Desativar Voz</option>
          <option value="ativarVoz">Ativar Voz</option>
      </select>
  </div>
</header>

<main class="wrap">
  <div class="panel">
    <h2 style="margin-top:0">Editar Perfil</h2>
    <p class="small">Altere seus dados abaixo. Todas as mudan√ßas pedem confirma√ß√£o antes de serem aplicadas.</p>

    <div class="row" style="margin-top:12px;">
      <div class="col">
        <label for="cfg_nome">1. Nome</label>
        <input id="cfg_nome" type="text" />

        <label for="cfg_idade" style="margin-top:12px;">2. Idade</label>
        <input id="cfg_idade" type="text" />

        <label for="cfg_def" style="margin-top:12px;">3. Possui defici√™ncia?</label>
        <input id="cfg_def" type="text" placeholder="Ex: visual, auditiva, motora ou nenhuma" />
      </div>

      <div class="col">
        <label for="cfg_nav">4. Prefer√™ncia de navega√ß√£o</label>
        <select id="cfg_nav">
          <option value="">(n√£o definido)</option>
          <option value="voz">Navega√ß√£o por voz</option>
          <option value="toque">Navega√ß√£o por toque</option>
          <option value="teclado">Teclado</option>
        </select>

        <label for="cfg_inter" style="margin-top:12px;">5. Interesses</label>
        <input id="cfg_inter" type="text" placeholder="Ex: filmes, m√∫sica, teatro..." />

        <label style="margin-top:12px;">6. Coisas favoritas</label>
        <div class="small">Adicione at√© 6 itens ‚Äî ex: g√™nero, artista, s√©rie.</div>
       <div class="fav-row" style="margin-top:8px;">
          <input id="favInput" type="text" placeholder="Adicionar favorito" style="flex:1" />
          <button class="btn ghost" id="addFavBtn">Adicionar</button>
        </div>
        <div id="favList" class="fav-list" aria-live="polite"></div>
      </div>
    </div>

    <hr style="border:0; height:1px; background:rgba(255,255,255,.04); margin:16px 0;" />

    <div class="row">
      <div class="col">
        <label for="cfg_senha">Senha (atualizar)</label>
        <div class="pwd-wrap" style="width:100%;">
          <input id="cfg_senha" type="password" placeholder="Deixe em branco para manter a senha atual" />
          <button class="pwd-toggle--config" id="pwdToggle" aria-label="Mostrar/ocultar senha">üëÅÔ∏è</button>
        </div>
        <div class="small" style="margin-top:8px;">Mantenha em branco se n√£o quiser alterar a senha.</div>
      </div>

      <div class="col" style="display:flex; flex-direction:column; justify-content:flex-end;">
        <div class="actions">
          <button class="btn primary" id="saveBtn">Salvar altera√ß√µes</button>
          <button class="btn ghost" id="logoutBtn">Sair (Logout)</button>
          <button class="btn danger" id="deleteBtn">Excluir minha conta</button>
        </div>

        <div class="small" style="margin-top:10px;color:var(--muted);">
          As altera√ß√µes ser√£o salvas na sua conta atual e na lista geral de usu√°rios.
        </div>
      </div>
    </div>
  </div>
</main>

<!-- Modal de confirma√ß√£o -->
<div id="modalConfirm" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="box">
    <h3 id="confirmTitle">Confirmar altera√ß√£o</h3>
    <div id="confirmBody" style="margin-top:8px;"></div>
    <div style="margin-top:12px; display:flex; gap:8px; justify-content:flex-end;">
      <button class="btn ghost" id="confirmNo">Cancelar</button>
      <button class="btn primary" id="confirmYes">Confirmar</button>
    </div>
  </div>
</div>

<!-- VLibras -->
<div vw class="enabled" style="z-index:1300">
  <div vw-access-button class="active"></div>
  <div vw-plugin-wrapper><div class="vw-plugin-top-wrapper"></div></div>
</div>

<script src="https://vlibras.gov.br/app/vlibras-plugin.js"></script>
<script> try { new window.VLibras.Widget('https://vlibras.gov.br/app'); } catch(e){ console.warn('VLibras init failed', e); } </script>

<script>
/* ======================
   UTILIDADES / VOZ
   ====================== */
let vozAtiva = true;
function lerTexto(txt){
  if (!vozAtiva || !txt) return;
  try{ speechSynthesis.cancel(); }catch(e){}
  const u = new SpeechSynthesisUtterance(txt);
  u.lang = 'pt-BR';
  try{ speechSynthesis.speak(u); }catch(e){}
}

/* alias usado em outras telas */
function falar(t, onend){ if (!vozAtiva) { if (typeof onend === 'function') onend(); return;} try{ speechSynthesis.cancel(); }catch(e){} const u=new SpeechSynthesisUtterance(t); u.lang='pt-BR'; if(onend) u.onend=onend; try{ speechSynthesis.speak(u);}catch(e){} }

/* ======================
   LEITURA DO USU√ÅRIO LOGADO
   ====================== */
/*
  Mecanismo escolhido (OP√á√ÉO B):
  - quando o usu√°rio fez login, devemos ter salvo:
      localStorage.setItem('usuarioLogado', nomeDoUsuario)
  - lista de usu√°rios: localStorage.getItem('usuariosConnectUs') -> array
  - perfilConnectUs √© mantido por compatibilidade, mas o "fonte da verdade" √© usuariosConnectUs + usuarioLogado
*/

function getUsuariosList(){
  try { return JSON.parse(localStorage.getItem('usuariosConnectUs')||'[]'); } catch(e){ return []; }
}
function saveUsuariosList(list){
  try { localStorage.setItem('usuariosConnectUs', JSON.stringify(list)); } catch(e){ console.warn(e); }
}
function getUsuarioLogadoNome(){
  return localStorage.getItem('usuarioLogado') || null;
}
function setUsuarioLogadoNome(nome){
  if (nome) localStorage.setItem('usuarioLogado', nome);
  else localStorage.removeItem('usuarioLogado');
}

/* pega o objeto do usu√°rio atual (ou null) */
function carregarUsuarioAtual(){
  const nome = getUsuarioLogadoNome();
  const lista = getUsuariosList();
  if (nome) {
    const u = lista.find(x => String(x.nome || '').toLowerCase() === String(nome).toLowerCase());
    if (u) return u;
  }
  // fallback para compatibilidade com perfilConnectUs
  try {
    const fallback = JSON.parse(localStorage.getItem('perfilConnectUs')||'{}');
    if (fallback && fallback.nome) return fallback;
  } catch(e){}
  return null;
}

/* popula inputs com dados do usu√°rio */
function popularForm(){
  const u = carregarUsuarioAtual();
  if (!u) {
    // sem usuario: informar e redirecionar p/ login
    lerTexto('Nenhum usu√°rio logado. Voc√™ ser√° redirecionado para a tela de cadastro.');
    setTimeout(()=> window.location.href = 'index.html', 900);
    return;
  }
  document.getElementById('cfg_nome').value = u.nome || '';
  document.getElementById('cfg_idade').value = u.idade || '';
  document.getElementById('cfg_def').value = u.deficiencia || '';
  document.getElementById('cfg_nav').value = u.navegacao || '';
  document.getElementById('cfg_inter').value = u.interesse || '';
  // favoritos
  const favs = Array.isArray(u.favoritos) ? u.favoritos.slice(0,6) : (u.favoritos ? (String(u.favoritos).split('|').slice(0,6)) : []);
  renderFavs(favs);
}

/* ======================
   FAVORITOS (simples)
   ====================== */
function renderFavs(list){
  const box = document.getElementById('favList');
  box.innerHTML = '';
  list = list || [];
  list.forEach((f, idx) => {
    const el = document.createElement('div');
    el.className = 'fav-item';
    el.textContent = f;
    el.setAttribute('data-idx', idx);
    el.tabIndex = 0;
    // remover ao clicar
    el.addEventListener('click', ()=> {
      confirmAction(`Remover favorito "${f}"?`, ()=>{
        // remove
        const usuario = carregarUsuarioAtual();
        if (!usuario) return;
        let favs = Array.isArray(usuario.favoritos) ? usuario.favoritos.slice() : (usuario.favoritos ? String(usuario.favoritos).split('|') : []);
        favs.splice(idx,1);
        usuario.favoritos = favs;
        updateUsuario(usuario);
        renderFavs(favs);
      });
    });
    box.appendChild(el);
  });
}

/* adicionar favorito */
document.getElementById('addFavBtn').addEventListener('click', function(e){
  e.preventDefault();
  const v = document.getElementById('favInput').value.trim();
  if (!v) { lerTexto('Digite o favorito antes de adicionar.'); return; }
  const usuario = carregarUsuarioAtual();
  if (!usuario) return;
  let favs = Array.isArray(usuario.favoritos) ? usuario.favoritos.slice() : (usuario.favoritos ? String(usuario.favoritos).split('|') : []);
  if (favs.length >= 6) { lerTexto('M√°ximo de 6 favoritos permitido.'); return; }
  favs.push(v);
  usuario.favoritos = favs;
  // confirma√ß√£o antes de efetivar
  confirmAction(`Adicionar favorito "${v}" ao seu perfil?`, ()=>{
    updateUsuario(usuario);
    renderFavs(favs);
    document.getElementById('favInput').value = '';
    lerTexto('Favorito adicionado.');
  });
});

/* ======================
   ATUALIZA√á√ÉO DO USU√ÅRIO
   ====================== */
function gatherFormChanges(){
  const usuario = carregarUsuarioAtual();
  if (!usuario) return null;
  const novo = {
    nome: (document.getElementById('cfg_nome').value || '').trim(),
    idade: (document.getElementById('cfg_idade').value || '').trim(),
    deficiencia: (document.getElementById('cfg_def').value || '').trim(),
    navegacao: (document.getElementById('cfg_nav').value || '').trim(),
    interesse: (document.getElementById('cfg_inter').value || '').trim(),
    senha: (document.getElementById('cfg_senha').value || '').trim(),
    favoritos: Array.isArray(usuario.favoritos) ? usuario.favoritos.slice() : (usuario.favoritos ? String(usuario.favoritos).split('|') : [])
  };
  // if senha blank => keep existing
  if (!novo.senha) novo.senha = usuario.senha || '';
  return { before: usuario, after: novo };
}

function diffSummary(before, after){
  const diffs = [];
  if ((before.nome||'') !== (after.nome||'')) diffs.push(`Nome: "${before.nome||'(vazio)'}" ‚Üí "${after.nome||'(vazio)'}"`);
  if ((before.idade||'') !== (after.idade||'')) diffs.push(`Idade: "${before.idade||'(vazio)'}" ‚Üí "${after.idade||'(vazio)'}"`);
  if ((before.deficiencia||'') !== (after.deficiencia||'')) diffs.push(`Defici√™ncia: "${before.deficiencia||'(vazio)'}" ‚Üí "${after.deficiencia||'(vazio)'}"`);
  if ((before.navegacao||'') !== (after.navegacao||'')) diffs.push(`Navega√ß√£o: "${before.navegacao||'(vazio)'}" ‚Üí "${after.navegacao||'(vazio)'}"`);
  if ((before.interesse||'') !== (after.interesse||'')) diffs.push(`Interesses: "${before.interesse||'(vazio)'}" ‚Üí "${after.interesse||'(vazio)'}"`);
  // senha: we don't print actual value
  if ((before.senha||'') !== (after.senha||'')) diffs.push(`Senha: ser√° atualizada`);
  // favoritos: shallow compare
  const A = (Array.isArray(before.favoritos) ? before.favoritos.join('|') : (before.favoritos||''));
  const B = (Array.isArray(after.favoritos) ? after.favoritos.join('|') : (after.favoritos||''));
  if (A !== B) diffs.push('Favoritos: altera√ß√£o');
  return diffs;
}

/* apply update to usuariosConnectUs list and perfilConnectUs + usuarioLogado */
function updateUsuario(novoUsuarioObj){
  const nomeAtual = getUsuarioLogadoNome() || ( (JSON.parse(localStorage.getItem('perfilConnectUs')||'{}')).nome );
  let lista = getUsuariosList();
  // find index by original name (case-insensitive)
  let idx = lista.findIndex(u => String(u.nome||'').toLowerCase() === String(nomeAtual||'').toLowerCase());
  if (idx === -1) {
    // se n√£o existe, adiciona
    lista.push(novoUsuarioObj);
  } else {
    lista[idx] = novoUsuarioObj;
  }
  saveUsuariosList(lista);
  // manter compat com perfilConnectUs e usuarioLogado
  localStorage.setItem('perfilConnectUs', JSON.stringify(novoUsuarioObj));
  setUsuarioLogadoNome(novoUsuarioObj.nome);
}

/* handler salvar altera√ß√µes (com confirma√ß√£o) */
document.getElementById('saveBtn').addEventListener('click', function(){
  const parts = gatherFormChanges();
  if (!parts) return;
  const diffs = diffSummary(parts.before, parts.after);
  if (!diffs.length) {
    lerTexto('Nenhuma altera√ß√£o detectada.');
    return;
  }
  // mostrar confirma√ß√£o com resumo
  const body = diffs.map(d=>'‚Ä¢ '+d).join('<br>');
  confirmAction(`<div>Deseja aplicar as seguintes altera√ß√µes?</div><div style="margin-top:10px;">${body}</div>`, ()=>{
    // aplicar: se o nome foi alterado, precisamos atualizar index (renomear)
    const beforeName = parts.before.nome || '';
    const after = parts.after;
    // atualizar lista: remover antigo se renomeado
    let lista = getUsuariosList();
    // remove entry with beforeName (case-insensitive)
    lista = lista.filter(u => String(u.nome||'').toLowerCase() !== String(beforeName).toLowerCase());
    // push updated
    lista.push(after);
    saveUsuariosList(lista);
    localStorage.setItem('perfilConnectUs', JSON.stringify(after));
    setUsuarioLogadoNome(after.nome);
    // limpar campo senha para seguran√ßa
    document.getElementById('cfg_senha').value = '';
    lerTexto('Altera√ß√µes salvas com sucesso.');
  });
});

/* ======================
   EXCLUIR CONTA
   - apaga apenas o usu√°rio logado da lista
   - remove perfilConnectUs e usuarioLogado
   ====================== */
document.getElementById('deleteBtn').addEventListener('click', function(){
  const u = carregarUsuarioAtual();
  if (!u) return;
  confirmAction(`Tem certeza que deseja <strong>excluir permanentemente</strong> a conta "${u.nome}"? Essa a√ß√£o n√£o pode ser desfeita.`, ()=>{
    // remove da lista
    let lista = getUsuariosList();
    lista = lista.filter(x => String(x.nome||'').toLowerCase() !== String(u.nome||'').toLowerCase());
    saveUsuariosList(lista);
    // limpar perfilConnectUs e usuarioLogado
    localStorage.removeItem('perfilConnectUs');
    setUsuarioLogadoNome(null);
    lerTexto('Conta exclu√≠da. Voc√™ ser√° redirecionado para a tela inicial.');
    setTimeout(()=> window.location.href = 'index.html', 900);
  });
});

/* ======================
   LOGOUT
   ====================== */
document.getElementById('logoutBtn').addEventListener('click', function(){
  confirmAction('Deseja sair da sua conta agora?', ()=>{
    setUsuarioLogadoNome(null);
    lerTexto('Logout realizado. Redirecionando para a tela inicial.');
    setTimeout(()=> window.location.href = 'index.html', 700);
  });
});

/* ======================
   PWD TOGGLE (bot√£o com classe espec√≠fica)
   ====================== */
document.getElementById('pwdToggle').addEventListener('click', function(){
  const campo = document.getElementById('cfg_senha');
  const btn = document.getElementById('pwdToggle');
  if (campo.type === 'password') { campo.type='text'; btn.textContent='üôà'; lerTexto('Senha vis√≠vel'); }
  else { campo.type='password'; btn.textContent='üëÅÔ∏è'; lerTexto('Senha oculta'); }
});

/* ======================
   Helper: janela de confirma√ß√£o custom (reutiliz√°vel)
   - mostra modalConfirm com conte√∫do HTML; retorna via callbacks
   ====================== */
function confirmAction(htmlContent, onYes){
  const modal = document.getElementById('modalConfirm');
  const titleEl = document.getElementById('confirmTitle');
  const bodyEl = document.getElementById('confirmBody');
  const yes = document.getElementById('confirmYes');
  const no  = document.getElementById('confirmNo');

  titleEl.innerText = 'Confirma√ß√£o';
  bodyEl.innerHTML = htmlContent;
  modal.style.display = 'flex';
  modal.setAttribute('aria-hidden','false');

  // handlers (removemos handlers antigos antes)
  function cleanup(){
    yes.removeEventListener('click', yesHandler);
    no.removeEventListener('click', noHandler);
    document.removeEventListener('keydown', escHandler);
    modal.style.display = 'none';
    modal.setAttribute('aria-hidden','true');
  }
  function yesHandler(){
    cleanup();
    if (typeof onYes === 'function') onYes();
  }
  function noHandler(){ cleanup(); lerTexto('Opera√ß√£o cancelada.'); }
  function escHandler(e){ if (e.key === 'Escape') noHandler(); }

  yes.addEventListener('click', yesHandler);
  no.addEventListener('click', noHandler);
  document.addEventListener('keydown', escHandler);

  // foco no bot√£o confirmar
  setTimeout(()=> yes.focus(), 100);
}

/* ======================
   INICIALIZA√á√ÉO
   ====================== */
document.addEventListener('DOMContentLoaded', ()=>{
  // popular formul√°rio
  popularForm();
  // garantir que modalConfirm comece oculto
  document.getElementById('modalConfirm').style.display = 'none';
});

/* small helper to read fields labels on hover for accessibility */
const inputs = document.querySelectorAll('#cfg_nome,#cfg_idade,#cfg_def,#cfg_nav,#cfg_inter,#cfg_senha');
inputs.forEach(i=>{
  i.addEventListener('mouseover', ()=> { if (i.placeholder) lerTexto(i.placeholder); else lerTexto(i.previousElementSibling ? i.previousElementSibling.innerText : 'Campo'); });
});

/* ======================
   DROPDOWN DE ACESSIBILIDADE
   ====================== */

// zoom visual
function zoomIn(){
  document.body.style.zoom =
    (parseFloat(document.body.style.zoom || 1) + 0.1).toFixed(2);
}

function zoomOut(){
  let z = parseFloat(document.body.style.zoom || 1) - 0.1;
  if (z < 0.6) z = 0.6;
  document.body.style.zoom = z.toFixed(2);
}

// tema
function toggleTheme(){
  document.body.classList.toggle('temaClaro');
  lerTexto(
    document.body.classList.contains('temaClaro')
      ? 'Tema claro ativado'
      : 'Tema escuro ativado'
  );
}

// modo calmo
function modoCalmo(){
  document.body.classList.toggle('modo-calmo');
  lerTexto('Modo calmo ativado');
}

/* ======================
   VOZ ‚Äî AGORA COM DROPDOWN DIN√ÇMICO
   ====================== */

// Desativar voz
function desativarVoz(){
  vozAtiva = false;

  try { speechSynthesis.cancel(); } catch(e){}

  atualizarDropdownVoz();

  alert("Voz desativada."); // N√£o usa TTS, porque est√° desativado
}

// Ativar voz
function ativarVoz(){
  vozAtiva = true;

  try {
    // desbloqueia engine do Chrome
    speechSynthesis.cancel();
    setTimeout(() => {
      const u = new SpeechSynthesisUtterance("Voz ativada.");
      u.lang = "pt-BR";
      speechSynthesis.speak(u);
    }, 60);
  } catch(e){}

  atualizarDropdownVoz();
}

/*  
    Atualiza automaticamente o dropdown.
    - Se voz ativa ‚Üí mostra "Desativar Voz"
    - Se voz desativada ‚Üí mostra "Ativar Voz"
*/
function atualizarDropdownVoz(){
  const sel = document.getElementById("menuAcessibilidade");
  if (!sel) return;

  // Remove op√ß√µes antigas
  sel.querySelectorAll("option[value='ativarVoz'], option[value='desativarVoz']")
     .forEach(o => o.remove());

  const opt = document.createElement("option");

  if (vozAtiva){
    opt.value = "desativarVoz";
    opt.textContent = "Desativar Voz";
  } else {
    opt.value = "ativarVoz";
    opt.textContent = "Ativar Voz";
  }

  sel.appendChild(opt);
}

/* Pausar leitura */
function pauseAudio(){ speechSynthesis.pause(); }

/* Retomar leitura */
function resumeAudio(){ speechSynthesis.resume(); }

/* seletor */
function executarOpcao(v){
  if (!v) return;

  const map = {
    zoomIn,
    zoomOut,
    modoCalmo,
    pauseAudio,
    resumeAudio,
    toggleTheme,
    desativarVoz,
    ativarVoz
  };

  if (map[v]) map[v]();

  // voltar para ‚öô
  setTimeout(()=>{
    const sel = document.getElementById("menuAcessibilidade");
    if (sel) sel.value = "";
  }, 100);
}

/* Inicializar dropdown correto no carregamento */


document.getElementById("btnHeaderSair").addEventListener("click", () => {
  lerTexto("Voltando para o menu de conte√∫dos.");
  setTimeout(() => {
    window.location.href = "menuConteudos.html";
  }, 600);
});

</script>

</body>
</html>


